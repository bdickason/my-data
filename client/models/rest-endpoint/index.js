// Generated by CoffeeScript 1.6.3
/* rest-endpoint - Model representing a single endpoint 
      -e.x. /email could contain :
              { personal: "dickason@gmail.com", work: "brad@shapeways.com"}
      -which would make /email/personal:
              "dickason@gmail.com"
*/


(function() {
  var Endpoint, model, request;

  request = require('superagent');

  model = require('model');

  module.exports = Endpoint = model('Endpoint').attr('url').attr('version').attr('keyUrl').attr('key').attr('value').attr('parameters');

  Endpoint.prototype.get = function(callback) {
    var _this = this;
    return request.get("" + this.attrs.url + "/" + this.attrs.version + "/" + this.attrs.keyUrl, function(err, res) {
      var key;
      if (err) {
        return console.log("Error: " + err);
      } else {
        _this.parameters = _this.parseUrl(_this.attrs.keyUrl);
        key = _this.parameters[_this.parameters.length - 1];
        _this.set({
          key: key
        });
        _this.set({
          value: res.body
        });
        return callback(_this.value);
      }
    });
  };

  Endpoint.prototype.toString = function() {
    var output;
    output = "";
    output += "Key: " + this.attrs.key + "\n";
    output += "Version: " + this.attrs.version + "\n";
    output += "Url: " + this.attrs.url + "\n";
    return output;
  };

  Endpoint.prototype.parseUrl = function(keyUrl) {
    var parameters;
    if (keyUrl[keyUrl.length - 1] === '/') {
      keyUrl = keyUrl.slice(0, keyUrl.length - 1);
    }
    parameters = keyUrl.split('/');
    return parameters;
  };

}).call(this);
